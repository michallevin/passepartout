angular.module("passepartoutApp",["passepartoutApp.questions","passepartoutApp.user","passepartoutApp.highscores","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/game",{templateUrl:"views/game.html",controller:"GameCtrl"}).when("/highscores",{templateUrl:"views/highscores.html",controller:"ScoresCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).when("/intro",{templateUrl:"views/intro.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("passepartoutApp").controller("MainCtrl",["$scope","$location","$User",function(a,b,c){a.username={name:"guest",word:/^\s*\w*\s*$/},a.startGame=function(){return a.username.name?(console.log(a.username.name),c.name=a.username.name,a.loading=!0,void c.getUserId(function(){console.log("loaded questions"),b.path("/game")})):void alert("You must choose a username!")},a.gotoHighScores=function(){console.log(a.username.name),b.path("/highscores")},a.gotoAdmin=function(){console.log(a.username.name),b.path("/admin")},a.gotoIntro=function(){console.log(a.username.name),b.path("/intro")}}]),angular.module("passepartoutApp").controller("GameCtrl",["$scope","$http","$Questions","$User","$location","$timeout",function(a,b,c,d,e,f){return a.currentQuestion=0,a.lives=3,a.score=0,a.guessed=-1,a.gameOver=0,a.loading=!1,a.questions=c.questions,0==a.questions.length?void e.path("/"):(a.getAnswerClass=function(b){return-1!=a.guessed&&b==a.questions[a.currentQuestion].answerIndex?"green":a.guessed==b?"red":""},a.guessAnswer=function(b){a.guessed=b,b==a.questions[a.currentQuestion].answerIndex?(setTimeout(function(){a.currentQuestion+=1,a.guessed=-1,a.currentQuestion==a.questions.length&&(console.log("insideeee"),a.gameOver=1),a.$apply()},1e3),a.score+=a.questions[a.currentQuestion].score):setTimeout(function(){a.lives-=1,a.lives>0&&(a.currentQuestion+=1),a.guessed=-1,a.currentQuestion==a.questions.length&&(console.log("insideeee"),a.gameOver=1),a.$apply()},1e3),console.log(a.currentQuestion),console.log(a.questions.length)},a.submitScore=function(){d.setHighscore(a.score,function(){e.path("/highscores")}),a.gameOver=0},a.startOver=function(){a.loading=!0,c.getQuestions(d.id,function(){console.log("loaded questions"),a.loading=!1,a.questions=c.questions,a.currentQuestion=0,a.lives=3,a.score=0}),a.gameOver=0},void(a.endGame=function(){a.currentQuestion=0,a.lives=3,a.score=0,a.gameOver=0,e.path("/")}))}]);var passepartoutApp=angular.module("passepartoutApp"),baseApiLocation="http://localhost:8080/rest/";passepartoutApp.questions=angular.module("passepartoutApp.questions",["passepartoutApp.user"]).factory("$Questions",["$http",function(a){function b(){this.questions=[]}return b.prototype.getQuestions=function(b,c){a({url:baseApiLocation+"question",method:"GET",params:{userId:b}}).success(function(a){this.questions=a,c()}.bind(this))},new b}]),passepartoutApp.user=angular.module("passepartoutApp.user",[]).factory("$User",["$http","$Questions",function(a,b){function c(){this.id=-1,this.name}return c.prototype.getUserId=function(c){a({url:baseApiLocation+"user/login",method:"GET",params:{name:this.name}}).success(function(a){console.log(a),this.id=a.id,console.log(this.id),console.log(this.name),b.getQuestions(this.id,c)}.bind(this))},c.prototype.setHighscore=function(b,c){a({url:baseApiLocation+"highscore",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{user_id:this.id,score:b}}).success(function(a){c()}.bind(this))},new c}]),passepartoutApp.highscores=angular.module("passepartoutApp.highscores",["passepartoutApp.user"]).factory("$Highscores",["$http","$User",function(a,b){function c(){this.highscores=[]}return c.prototype.getHighscores=function(){a({url:baseApiLocation+"highscore/top",method:"GET",params:{}}).success(function(a){this.highscores=a}.bind(this))},new c}]),angular.module("passepartoutApp").controller("ScoresCtrl",["$scope","$location","$User","$Highscores",function(a,b,c,d){a.scores=[{name:"Yotam",score:230},{name:"Eden",score:450}]}]),angular.module("passepartoutApp").controller("AdminCrl",["$scope","$http",function(a,b){a.isImporting=!1,a.startImport=function(){$AdminService.startImport(function(){a.isImporting=!0})},a.cancelImport=function(){$AdminService.cancelImport(function(){a.isImporting=!1})},a.getImportUpdate=function(){$AdminService.getImportUpdate(function(b){a.isImporting=b})}}]);